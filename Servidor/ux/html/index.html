<!--

// TODO: Añadir numero de alertas en la campana. Código robado de la pagina Toys r us:


<div class="nav-cart"> //carrito de la compra
		<div class="mini-cart-icon"> //icono
		    <img src="/_ui/responsive/common/images/carritohead.svg" class="birhcman-mini-cart-image" width="32" height="32">
		</div>
		<div class="mini-cart-count js-mini-cart-count">
		    <span class="nav-items-total"> //utilizan un span para hacer la cuenta de objetos comprados
		        0
		    <span class="items-desktop hidden-xs hidden-sm hidden-md hidden-lg">
		        &nbsp;Artículos
		    </span>
		    </span>
		</div>
</div>

CSS
@media (max-width: 639px)
.navigation--middle .nav-cart .mini-cart-link .nav-items-total {
    display: inline-block;
    background-color: #f01446;
    border-radius: 50%;
    height: 20px;
    width: 20px;
    color: #fff;
    line-height: 20px;
}


TODO: function comprobarClave(){
    clave1 = document.f1.clave1.value
    clave2 = document.f1.clave2.value

    if (clave1 == clave2)
       alert("Las dos claves son iguales...\nRealizaríamos las acciones del caso positivo")
    else
       alert("Las dos claves son distintas...\nRealizaríamos las acciones del caso negativo")
}

TODO: https://bootsnipp.com/snippets/402bQ

-->

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Autor: -->
    <meta name="author" content="<Adrián Heras Reche y contribuidores de Bootstrap como Jason Doe">

    <!--Descripcion: -->
    <meta name="description" content="Página web de envirometrics SA, creada para curso 3A de GTI">
    <title>Página de administración</title>


    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- CSS del Nav Bar -->
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/index.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300|Work+Sans:300&display=swap" rel="stylesheet">

    <!-- Scripts -->
    <script type="text/javascript" src="../proxy.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTrzSIM3o7jvT0ExtK8KpNExtDQc1pddw&libraries=visualization&callback=inicializarMapa" async defer></script>
    
    <script>
        var elProxy1 = new Proxy()

        function inicializarMapa() {

            // Creamos un objeto mapa y especificamos el elemento DOM donde se va a mostrar.
            var map = new google.maps.Map(document.getElementById('mapa'), {
                center: {
                    lat: 38,
                    lng: -0.16
                },
                scrollwheel: false,
                zoom: 8,
                zoomControl: true,
                rotateControl: false,
                mapTypeControl: true,
                streetViewControl: false,
            });

            var heatmapData = [];

            elProxy1.getTodasLasMedidas(function(res) {
                for (let i = 0; i < res.length; i++) {
                    //Añadir los valores de las medidas al mapa de color
                    heatmapData.push({
                        location: new google.maps.LatLng(res[i].latitud, res[i].longitud),
                        weight: res[i].valorMedida
                    });

                    console.log("Latitud: " + res[i].latitud);
                    console.log("longitud: " + res[i].longitud);
                    console.log("valorMedida: " + res[i].valorMedida);

                }
            })

            var colors = [
            'rgb(102, 225, 0)',
            'rgb(255, 0, 0)'
            ]
            
            var heatmap = new google.maps.visualization.HeatmapLayer({
                data: heatmapData,
                maxIntensity: 100000,
                radius: 50,
            });

            heatmap.setMap(map);
            heatmap.set(gradient);


        }

    </script>

</head>


<!------------------------------------------------------------>
<!--    Body    -->
<!------------------------------------------------------------>

<body>

    <!-- Contenido -->
    <div class="page-content index" id="content">

        <!-- Search Bar -->
        <div class="searchbar-dark">
            <p class="empresaIndex">
                <img src="../images/icon_env.png" alt="" width="auto" height="50px">
                Envirometrics
            </p>
            <button class="buttonLogIn btn btn-outline-light" id="login-button" onclick="iniciarSesionWithCookie()">Log In</button>
        </div>

        <!-- Content -->

        <div class="modal" id="loginModal">

            <div class="row modal-content">
                <div class="modal-header">
                    <h1 class="h3 font-weight-normal titulo">Envirometrics</h1>
                    <span class="close">&times;</span>
                </div>

                <div class="modal-body">
                    <form class="col-12 loginForm">
                        <div class="text-center mb-4">
                            <img class="loginImg" src="../images/icon_env.png" alt="Imagen del logo" width="20%" height="20%">
                        </div>

                        <div class="form-label-group">
                            <label for="inputEmail" class="loginLabel">Email address</label>
                            <input type="text" id="inputEmail" class="form-control loginInput" placeholder="Email address" required="" autofocus="">
                        </div>

                        <div class="form-label-group">
                            <label for="inputPassword" class="loginLabel">Password</label>
                            <input type="password" id="inputPassword" class="form-control loginInput" placeholder="Password" required="">
                            <div class="alert alert-danger" role="alert" id="errorCredenciales">
                                Nombre de usuario o la contraseña son incorrectos.
                            </div>
                        </div>

                        <div class="checkbox mb-3 loginLabel">
                            <label>
                                <input type="checkbox" value="remember-me" id="remember-me"> Remember me
                            </label>
                        </div>
                        <input type="button" class="btn btn-lg btn-primary btn-block loginButton" type="submit" onclick="iniciarSesionOnClickButton()" value="Sign in">
                        <p class="mt-5 mb-3 text-muted text-center">© 2019 GTI</p>
                    </form>
                </div>

            </div>
        </div>

        <div class="mapa" id="mapa"></div>

        <div class="publicidad">
            <h1>
                Mapas de contaminación desde la comodidad de tu casa
            </h1>
            <div class="row">
                <div class="col-sm-4 col-xs-12">
                    <i class="fa fa-mobile fa-4x indexIcon"></i> <br />
                    Envirometrics te ofrece una aplicación que cumple todas tus necesidades y te permite viajar en taxi de manera eficiente evitando rutas contaminadas con varios gases nocivos como el monóxido de carbono o el metano.
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-map fa-3x indexIcon"></i> <br />
                    Envirometrics te ofrece un mapa de contaminación actualizado cada 24 horas para que puedas evitar las rutas más contaminadas durante tus trayectos diarios.
                </div>
                <div class="col-sm-4">
                    <i class="fa fa-camera fa-3x indexIcon"></i> <br />
                    Envirometrics te ofrece la posibilidad de saber la contaminación del ambiente con solo tomar una foto al aire. Esto permite una mayor rápidez de actuación de cara a evitar los trayectos con mayor contaminación en tu ciudad.
                </div>
            </div>
        </div>

        <div class="sobreNosotros">
            <div class="row">
                <div class="col-lg-6">
                    <img src="../images/genteTrabaja.jpg" alt="" class="genteTrabajaImagen">
                </div>
                <div class="col-lg-6">
                    <h1>Sobre Nosotros</h1>
                    <p>
                        Envirometrics es una empresa compuesta por 4 estudiantes de la Universidad Politécnica de Valencia cuya metodología de trabajo está basada en Scrum. Cada dos semanas se revisan los cambios que le hemos añadido a nuestro producto y pensamos en futuras mejoras. Nuestro ambiente de trabajo está basado en el trabajo en equipo y todos los miembros se ayudan entre sí. Nuestro objetivo a lograr con este proyecto es mejorar la salud media de los ciudadanos, debido a las altas medidas de contaminación en ciudades tan grandes como Madrid, donde puede verse cierto smog.
                    </p>

                    <img src="../images/google_play_download.png" alt="" width="50%">

                </div>
            </div>
        </div>

    </div>


    <!--        Scripts         -->

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <!-- Bootstrap.js -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


    <!-- SCRIPTS -->
    <script>
        //-------------------------------------------------------------------
        // Para el modal
        //-------------------------------------------------------------------
        var modal = document.getElementById("loginModal");
        var btn = document.getElementById("login-button");
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }


        //creamos el Proxy
        var elProxy = new Proxy();

        // ------------------------------------------------------------------
        // quanEsCarrega()
        // ------------------------------------------------------------------
        function quanEsCarrega() {

            console.log("Plana UX carregada.")

        }

        // ------------------------------------------------------------------
        // nombre:Texto, password:Texto -->
        // iniciarSesion()
        // Cookie
        // ------------------------------------------------------------------
        async function iniciarSesion(_nombre, _password) {

            console.log(_nombre + " " + _password);

            var json = {
                nombre: _nombre,
                password: _password
            }

            console.log(json)

            elProxy.iniciarSesion(json, function(res) {

                if (res == true) {
                    if (document.getElementById("remember-me").checked) {
                        document.cookie = JSON.stringify(json);
                    }
                    window.location.replace('admin.html');
                } else {
                    //alert("Credenciales erróneas")
                    $('#errorCredenciales').show();
                }
                console.log(res)
            })

            console.log("Voy a iniciarSesion")

        }

        // ------------------------------------------------------------------
        // iniciarSesionOnLoad()
        // ------------------------------------------------------------------
        async function iniciarSesionWithCookie() {
            if (!document.cookie) {
                modal.style.display = "block";
                $('#errorCredenciales').hide();
            } else {
                var laCookie = JSON.parse(document.cookie)
                var nombre = laCookie.nombre;
                var password = laCookie.password;
                await iniciarSesion(nombre, password)
            }
        }

        // ------------------------------------------------------------------
        // iniciarSesionOnClickButton()
        // ------------------------------------------------------------------
        async function iniciarSesionOnClickButton() {
            var nombre = document.getElementById("inputEmail").value;
            var password = document.getElementById("inputPassword").value;
            await iniciarSesion(nombre, password)
        }

    </script>
</body>

</html>
