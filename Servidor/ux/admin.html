<!--

// TODO: Añadir numero de alertas en la campana. Código robado de la pagina Toys r us:


<div class="nav-cart"> //carrito de la compra
		<div class="mini-cart-icon"> //icono
		    <img src="/_ui/responsive/common/images/carritohead.svg" class="birhcman-mini-cart-image" width="32" height="32">
		</div>
		<div class="mini-cart-count js-mini-cart-count">
		    <span class="nav-items-total"> //utilizan un span para hacer la cuenta de objetos comprados
		        0
		    <span class="items-desktop hidden-xs hidden-sm hidden-md hidden-lg">
		        &nbsp;Artículos
		    </span>
		    </span>
		</div>
</div>

CSS
@media (max-width: 639px)
.navigation--middle .nav-cart .mini-cart-link .nav-items-total {
    display: inline-block;
    background-color: #f01446;
    border-radius: 50%;
    height: 20px;
    width: 20px;
    color: #fff;
    line-height: 20px;
}

-->

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Autor: -->
    <meta name="author" content="<Adrián Heras Reche y contribuidores de Bootstrap como Jason Doe">

    <!--Descripcion: -->
    <meta name="description" content="Página web de envirometrics SA, creada para curso 3A de GTI">
    <title>Página de administración</title>


    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- CSS del Nav Bar -->
    <link rel="stylesheet" href="css/styles.css">

</head>


<!------------------------------------------------------------>
<!--    Body    -->
<!------------------------------------------------------------>

<body onload="getUltimaMedidaDeUnUsuarioOnLoad()">

    <!-- Vertical navbar -->
    <div class="vertical-nav" id="sidebar">

        <!-- Logo del sidebar-->
        <div class="py-4 px-3 mb-4">
            <div class="media d-flex align-items-center">
                <img src="images/icn_envirometrics.png" alt="Logo de la empresa" height="70%" width="70%" class="indexImg">
            </div>
        </div>

        <!-- Sidebar -->
        <ul class="nav flex-column mb-0">
            <li class="nav-item">
                <a href="#" class="nav-link indexSidebar">
                    <i class="fa fa-home fa-lg indexIcon" style="margin-right: 0.5em"></i>
                    Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link indexSidebar">
                    <i class="fa fa-taxi fa-sm indexIcon"></i>
                    Taxistas
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link indexSidebar">
                    <i class="fa fa-balance-scale fa-sm indexIcon"></i>
                    Sensores
                </a>
            </li>
        </ul>
    </div>

    <!-- Contenido -->
    <div class="page-content" id="content">

        <!-- Search Bar -->
        <div class="searchbar">
            <i class="fa fa-bell fa-3x searchIcon"></i>

            <div class="dropdown">
                <i class="fa fa-user fa-3x searchIcon" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>
                
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                    <a class="dropdown-item" href="#" onclick="logOut()">Log Out</a>
                </div>
            </div>


        </div>

        <!-- Content -->
        <div class="dashboard">

            <div class="row informacionCentral">
                <div class="col-4">
                    <div class="cuadradoCentral">
                        <div>
                            <p>Última medida</p>
                        </div>
                        <span class="numero" id="medida">
                            #
                        </span>
                    </div>
                </div>

                <div class="col-4">
                    <div class="cuadradoCentral">
                        <div>
                            <p>Taxistas contratados</p>
                        </div>
                        <span class="numero" id="numeroTaxistas">
                        </span>
                    </div>
                </div>

                <div class="col-4">
                    <div class="cuadradoCentral">
                        <div>
                            <p>Sensores activos</p>
                        </div>
                        <span class="numero" id="sensores">
                            1
                        </span>
                    </div>
                </div>
            </div>

            <!-- Tabla de ultimas medidas -->
            <div class="row tabla">

                <p>Últimas medidas</p>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Medida</th>
                            <th>Tipo de medida</th>
                            <th>Valor de medida</th>
                            <th>Tiempo</th>
                            <th>Latitud</th>
                            <th>Longitud</th>
                            <th>Taxista</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td scope="row">1</td>
                            <td>Calidad del aire</td>
                            <td>115000</td>
                            <td>13:37 28/10/2019</td>
                            <td>4350650</td>
                            <td>675603</td>
                            <td>HerGut@envirometrics.com</td>
                        </tr>
                        <tr>
                            <td scope="row">2</td>
                            <td>Calidad del aire</td>
                            <td>115000</td>
                            <td>13:37 28/10/2019</td>
                            <td>4350650</td>
                            <td>675603</td>
                            <td>HerGut@envirometrics.com</td>
                        </tr>
                        <tr>
                            <td scope="row">3</td>
                            <td>Calidad del aire</td>
                            <td>115000</td>
                            <td>13:37 28/10/2019</td>
                            <td>4350650</td>
                            <td>675603</td>
                            <td>HerGut@envirometrics.com</td>
                        </tr>
                        <tr>
                            <td scope="row">4</td>
                            <td>Calidad del aire</td>
                            <td>115000</td>
                            <td>13:37 28/10/2019</td>
                            <td>4350650</td>
                            <td>675603</td>
                            <td>HerGut@envirometrics.com</td>
                        </tr>
                        <tr>
                            <td scope="row">5</td>
                            <td>Calidad del aire</td>
                            <td>115000</td>
                            <td>13:37 28/10/2019</td>
                            <td>4350650</td>
                            <td>675603</td>
                            <td>HerGut@envirometrics.com</td>
                        </tr>
                        <tr>
                            <td scope="row">6</td>
                            <td>Calidad del aire</td>
                            <td>115000</td>
                            <td>13:37 28/10/2019</td>
                            <td>4350650</td>
                            <td>675603</td>
                            <td>HerGut@envirometrics.com</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>


    <!--        Scripts         -->

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <!-- Bootstrap.js -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!-- JS del Nav Bar -->
    <script type="text/javascript" src="proxy.js"></script>

    <script>
        var elProxy = new Proxy();

        function getUltimaMedidaDeUnUsuario() {
            elProxy.getUltimaMedidaDeUnUsuario(1, function(res) {
                document.getElementById("medida").innerHTML = res.valorMedida;
                console.log(res)
            })
        }

        function getCuantosUsuariosHay() {
          elProxy.getUsuarios(function(res){
                document.getElementById("numeroTaxistas").innerHTML = res.length;
          })
        }

        function getUltimaMedidaDeUnUsuarioOnLoad() {
            getUltimaMedidaDeUnUsuario();
            getCuantosUsuariosHay()
        }

        function usuariosSinMedidasEn24H() {
          elProxy.getUsuarios(function (listaUsuarios){
            for( var i = 0; i < listaUsuarios.length; i++ ){
              elProxy.getUltimaMedidaDeUnUsuario( listaUsuarios[i].idUsuario, function(medida){
                var now = Date.now();
                if( (now - medida.tiempo) > 86400000 ){
                  console.log(medida.idUsuario);
                }
              })
            }
          })
        }

        function getUltimaMedidaDeTodosLosUsuarios() {
          elProxy.getUsuarios(function (listaUsuarios){
            for( var i = 0; i < listaUsuarios.length; i++ ){
              elProxy.getUltimaMedidaDeUnUsuario( listaUsuarios[i].idUsuario, function(medida){
                console.log(medida)
              })
            }
          })
        }

        function logOut() {
            document.cookie = "";
            window.location.replace('login.html');
        }

    </script>

</body>

</html>
